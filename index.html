<!DOCTYPE html>
<html dir="rtl">

<head>
  <meta name="viewport">
  <link rel='stylesheet' id='google-fonts-1-css'
    href='https://fonts.googleapis.com/css?family=Roboto%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2C400italic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic%7CRoboto+Slab%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2C400italic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic&#038;display=swap&#038;ver=6.5.3'
    type='text/css' media='all' />
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
</head>

<body style="font-family: Roboto;">
  <div id="wordpress" style="display: none;">
    <div class="col-lg-9 order-lg-last">
      <h1 class="product_title entry-title wd-entities-title">
        فرش 1200 شانه طرح مدوسا
      </h1>

      <table class="variations" cellspacing="0">
        <tbody>
          <link rel="stylesheet" id="wd-woo-mod-swatches-style-1-css"
            href="https://shamdouni.com/wp-content/themes/woodmart/css/parts/woo-mod-swatches-style-1.min.css?ver=7.3.1"
            type="text/css" media="all" />
          <link rel="stylesheet" id="wd-woo-mod-swatches-dis-1-css"
            href="https://shamdouni.com/wp-content/themes/woodmart/css/parts/woo-mod-swatches-dis-style-1.min.css?ver=7.3.1"
            type="text/css" media="all" />
          <tr>
            <th class="label cell"><label for="pa_color">رنگ</label></th>
            <td class="value cell with-swatches">
              <div
                class="wd-swatches-product wd-swatches-single wd-bg-style-1 wd-text-style-1 wd-dis-style-1 wd-size-default wd-shape-round"
                data-id="pa_color">
                <div class="wd-swatch wd-bg wd-tooltip wd-active" data-value="%d8%af%d9%88%d8%af%db%8c"
                  data-title="دودی" selected='selected'>
                  <span class="wd-swatch-bg" style="background-color:rgb(79,79,79)">
                  </span>
                  <span class="wd-swatch-text">
                    دودی </span>
                </div>
                <div class="wd-swatch wd-bg wd-tooltip" data-value="zoghali" data-title="ذغالی">
                  <span class="wd-swatch-bg" style="background-color:rgb(91,81,80)">
                  </span>
                  <span class="wd-swatch-text">
                    ذغالی </span>
                </div>
                <div class="wd-swatch wd-bg wd-tooltip" data-value="toosi" data-title="طوسی">
                  <span class="wd-swatch-bg" style="background-color:rgb(106,106,104)">
                  </span>
                  <span class="wd-swatch-text">
                    طوسی </span>
                </div>
                <div class="wd-swatch wd-bg wd-tooltip" data-value="%d9%86%d9%82%d8%b1%d9%87-%d8%a7%db%8c"
                  data-title="نقره‌ای">
                  <span class="wd-swatch-bg" style="background-color:rgb(168,169,164)">
                  </span>
                  <span class="wd-swatch-text">
                    نقره‌ای </span>
                </div>
              </div>
              <select id="pa_color" class="" name="attribute_pa_color" data-attribute_name="attribute_pa_color"
                data-show_option_none="yes">
                <option value="">یک گزینه را انتخاب کنید</option>
                <option value="%d8%af%d9%88%d8%af%db%8c" selected='selected'>دودی</option>
                <option value="zoghali">ذغالی</option>
                <option value="toosi">طوسی</option>
                <option value="%d9%86%d9%82%d8%b1%d9%87-%d8%a7%db%8c">نقره‌ای</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>

      <figure
        class="woocommerce-product-gallery__wrapper owl-items-lg-1 owl-items-md-1 owl-items-sm-1 owl-items-xs-1 owl-carousel wd-owl"
        data-hide_pagination_control="yes">
        <div class="product-image-wrap">
          <figure
            data-thumb="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z-150x200.jpg"
            class="woocommerce-product-gallery__image"><a data-elementor-open-lightbox="no"
              href="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z.jpg"><img
                fetchpriority="high" width="600" height="800"
                src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z.jpg"
                class="wp-post-image wp-post-image" alt="ذغالی" title="1473-z" data-caption=""
                data-src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z.jpg"
                data-large_image="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z.jpg"
                data-large_image_width="600" data-large_image_height="800" decoding="async"
                srcset="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z.jpg 600w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z-225x300.jpg 225w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z-430x573.jpg 430w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-z-150x200.jpg 150w"
                sizes="(max-width: 600px) 100vw, 600px" /></a></figure>
        </div>
        <div class="product-image-wrap">
          <figure
            data-thumb="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n-150x200.jpg"
            class="woocommerce-product-gallery__image">
            <a data-elementor-open-lightbox="no"
              href="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n.jpg">
              <img width="600" height="800"
                src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n.jpg" class=""
                alt="طوسی" title="1473-n" data-caption=""
                data-src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n.jpg"
                data-large_image="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n.jpg"
                data-large_image_width="600" data-large_image_height="800" decoding="async"
                srcset="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n.jpg 600w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n-225x300.jpg 225w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n-430x573.jpg 430w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-n-150x200.jpg 150w"
                sizes="(max-width: 600px) 100vw, 600px" /></a>
          </figure>
        </div>
        <div class="product-image-wrap">
          <figure
            data-thumb="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d-150x200.jpg"
            class="woocommerce-product-gallery__image">
            <a data-elementor-open-lightbox="no"
              href="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d.jpg">
              <img width="600" height="800"
                src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d.jpg" class=""
                alt="دودی" title="1473-d" data-caption=""
                data-src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d.jpg"
                data-large_image="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d.jpg"
                data-large_image_width="600" data-large_image_height="800" decoding="async"
                srcset="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d.jpg 600w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d-225x300.jpg 225w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d-430x573.jpg 430w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-d-150x200.jpg 150w"
                sizes="(max-width: 600px) 100vw, 600px" /></a>
          </figure>
        </div>
        <div class="product-image-wrap">
          <figure
            data-thumb="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil-150x200.jpg"
            class="woocommerce-product-gallery__image">
            <a data-elementor-open-lightbox="no"
              href="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil.jpg">
              <img loading="lazy" width="600" height="800"
                src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil.jpg" class=""
                alt="نقره ای" title="1473-sil" data-caption=""
                data-src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil.jpg"
                data-large_image="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil.jpg"
                data-large_image_width="600" data-large_image_height="800" decoding="async"
                srcset="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil.jpg 600w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil-225x300.jpg 225w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil-430x573.jpg 430w, https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/1473-sil-150x200.jpg 150w"
                sizes="(max-width: 600px) 100vw, 600px" /></a>
          </figure>
        </div>
      </figure>
    </div>
  </div>

  <!-- barrier -->


  <div style="padding-top: 25px; border-top: 1px solid silver;">

    <style>
      .ar-container {
        width: 350px;
        height: 250px;
        margin: auto;
        border: 1px solid silver
      }

      @media screen and (max-width:500px) {
        .ar-container {
          width: 70%
        }
      }

      model-viewer {
        width: 100%;
        height: 99%;
        position: relative;
        background-color: #fff;
        overflow-x: hidden
      }

      .only-ar,
      :not(:defined)>* {
        display: none
      }

      #ar-button {
        background-image: url(https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/img/view_in_ar_shamdouni.png);
        background-repeat: no-repeat;
        background-size: 20px 20px;
        background-position: 12px 50%;
        background-color: #fff;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        bottom: 5%;
        padding: 0 16px 0 40px;
        font-family: sans, Roboto Regular, Helvetica Neue, sans-serif;
        font-size: 14px;
        color: #358597;
        height: 36px;
        line-height: 36px;
        border-radius: 18px;
        border: 1px solid #dadce0
      }

      #ar-button:active {
        background-color: #e8eaed
      }

      #ar-button:focus {
        outline: 0
      }

      #ar-button:focus-visible {
        outline: #358597 solid 1px
      }

      model-viewer[ar-status=object-placed]>.only-ar,
      model-viewer[ar-status=session-started]>.only-ar {
        display: block
      }
    </style>
    <link href="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/css/bootstrap.min.v0.1.css"
      rel="stylesheet" type="text/css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>

    <h4>تکنولوژی واقعیت افزوده (پرو مجازی فرش)</h4>

    <div class="ar-container">
      <script type="module">
        import { ModelViewerElement } from 'https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js';
      </script>

      <model-viewer id="carpet" camera-controls touch-action="pan-y"
        src="https://raw.githubusercontent.com/mahdavifar2002/carpet/main/assets/glb/plane-6m.glb" ar ar-scale="fixed"
        ar-modes="webxr scene-viewer quick-look" camera-orbit="-22.5deg 60deg 70%" camera-target="0m -0.5m 0m"
        alt="A 3D model of a carpet">

        <button slot="ar-button" id="ar-button">
          در خانه‌ی خود ببینید
        </button>

        <div class="only-ar">

          <div class="pos-f-t">
            <div class="collapse show" id="navbarToggleExternalContent">
              <div class="p-4" style="background-color: #6c757d88;">

                <div dir="ltr">
                  <button class="btn btn-close" onclick="document.getElementById('ar-exit').click()"></button>
                </div>

                <h2 class="text-light" id="ar-title" style="display: none;">پرو مجازی فرش</h2>

                <div>
                  <label class="text-light">ابعاد: <b id="size-report"></b></label>
                  <div id="sizes"></div>
                </div>

                <div>
                  <label class="text-light">رنگ: <b id="color-report"></b></label>
                  <div id="colors"></div>
                </div>

                <div style="display: none;">
                  <label class="form-label text-light">رنگ:</label>
                  <select class="form-select" id="diffuse">
                  </select>
                </div>

              </div>
            </div>

            <div class="bg-dark" style="border: 3px solid black;">
            </div>
          </div>
          <div dir="ltr" class="container" style="margin-left: 50px;">
            <div id="half-circle"
              style="background-color: #6c757d88; width: 60px; height: 30px; border-bottom-left-radius: 34px; border-bottom-right-radius: 34px; border: 4px solid black; border-top: 0; position: absolute;"
              class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent"
              aria-expanded="true" aria-label="Toggle navigation">
              <i id="arrow" style="color: black; font-size: 30px; margin-top: -3px; position: absolute;"
                class="bi bi-arrow-up-short"></i>
            </div>
          </div>
        </div>

        <button id="ar-exit" slot="exit-webxr-ar-button" style="display: none;"><i class="bi bi-x-lg"></i></button>

      </model-viewer>

      <script type="module">

        // script to toggle the collapsible

        var myCollapsible = document.getElementById('navbarToggleExternalContent');

        myCollapsible.addEventListener('hide.bs.collapse', function () {
          var arrow = document.getElementById('arrow');
          arrow.classList.remove('bi-arrow-up-short');
          arrow.classList.add('bi-arrow-down-short');
        });

        myCollapsible.addEventListener('show.bs.collapse', function () {
          var arrow = document.getElementById('arrow');
          arrow.classList.remove('bi-arrow-down-short');
          arrow.classList.add('bi-arrow-up-short');
        });

        // script to put product title on top of ar

        document.getElementById("ar-title").textContent = document.querySelector(".product_title").textContent;

        // script to load colors variants

        const modelViewer = document.querySelector("model-viewer#carpet");

        const createAndApplyTexture = async (textureSrc) => {
          const channel = 'baseColorTexture';
          const material = modelViewer.model.materials[0];
          const texture = await modelViewer.createTexture(textureSrc);
          if (channel.includes('base') || channel.includes('metallic')) {
            material.pbrMetallicRoughness[channel].setTexture(texture);
          } else {
            material[channel].setTexture(texture);
          }
        };

        const createAndApplyTextureHelper = async (event) => {
          createAndApplyTexture(event.target.value);
        }

        document.getElementById('diffuse').addEventListener('input', (event) => {
          createAndApplyTextureHelper(event);
        });

        modelViewer.addEventListener("load", () => {
          document.getElementById('diffuse').dispatchEvent(new Event('input'));
        });

        // script to fix the roughness factor for carpet

        modelViewer.addEventListener("load", () => {
          var material = modelViewer.model.materials[0];
          material.pbrMetallicRoughness.setRoughnessFactor(1);
        });

        // script to add color options

        var select = document.getElementById('diffuse');

        for (const imageItem of document.getElementsByClassName("product-image-wrap")) {
          let imageHref = imageItem.firstElementChild.firstElementChild.href;
          let colorName = imageItem.firstElementChild.firstElementChild.firstElementChild.alt;

          let opt = document.createElement('option');
          opt.value = imageHref;
          opt.textContent += colorName;
          if (opt.textContent.length) {
            select.appendChild(opt);
          }
        }

        var colors = document.getElementById('colors');

        for (const item of document.querySelectorAll(".wd-swatch, .wd-bg, .wd-tooltip")) {
          let button = document.createElement('button');
          button.classList.add("btn", "btn-dark", "ms-1", "mb-1");

          let i = document.createElement('i');
          let span = document.createElement('span');
          i.classList.add("bi", "bi-circle-fill", "h4");

          span.textContent = " " + item.getAttribute("data-title");
          i.style.color = item.firstElementChild.style.backgroundColor;

          button.appendChild(i);
          button.appendChild(span);

          for (const imageItem of document.getElementsByClassName("product-image-wrap")) {
            let imageHref = imageItem.firstElementChild.firstElementChild.href;
            let colorName = imageItem.firstElementChild.firstElementChild.firstElementChild.alt;

            let text1 = span.textContent.replace(/\s/g, "").replace("\u200C", "");
            let text2 = colorName.replace(/\s/g, "").replace("\u200C", "");

            if (text1 == text2) {
              colors.appendChild(button);
              button.onclick = function () {
                createAndApplyTexture(imageHref);

                let colorReport = document.getElementById("color-report");
                colorReport.textContent = span.textContent;
              };
              break;
            }
          }
        }

        // script to load sizes

        const switchSrc = (newSrc) => {
          modelViewer.src = newSrc;
        };

        const dimDict = {
          "۶ متری": [3, 1, 2],
          "۹ متری": [3.5, 1, 2.5],
          "۱۲ متری": [4, 1, 3]
        };
        const referenceDim = dimDict["۶ متری"];

        var sizes = document.getElementById('sizes');
        let sizeReport = document.getElementById("size-report");

        for (const size in dimDict) {
          let dim = dimDict[size];

          let button = document.createElement('button');
          button.classList.add("btn", "btn-dark", "ms-1", "mb-1");
          button.textContent = size;

          button.onclick = function () {
            modelViewer.scale = dim[0] / referenceDim[0] + " " + dim[1] / referenceDim[1] + " " + dim[2] / referenceDim[2];

            sizeReport.textContent = button.textContent;
          }

          sizes.appendChild(button);
        }
      </script>
    </div>
  </div>


  <!-- barrier -->


  <p><br><br><br><br></p>

  <script>

    // sandbox

    // function watchVariable(obj, propName, callback) {
    //   let value = obj[propName];

    //   Object.defineProperty(obj, propName, {
    //     get() {
    //       return value;
    //     },
    //     set(newValue) {
    //       if (newValue !== value) {
    //         const oldValue = value;
    //         value = newValue;
    //         callback(newValue, oldValue);
    //       }
    //     },
    //   });
    // }

    // watchVariable(modelViewer, "scale", (newValue, oldValue) => {
    //   let newScale = newValue.split(" ").map((e) => parseFloat(e));
    //   let newDim = [newScale[0] * referenceDim[0], newScale[1] * referenceDim[1], newScale[2] * referenceDim[2]];
    //   sizeReport.textContent = faNumber(newDim[0]) + "×" + faNumber(newDim[2]);
    // });



    // const modelViewer = document.querySelector("model-viewer#carpet");


    // const dimDict = {
    //   "۶ متری": [3, 1, 2],
    //   "۹ متری": [3.5, 1, 2.5],
    //   "۱۲ متری": [4, 1, 3]
    // };
    // const referenceDim = dimDict["۶ متری"];

    // let sizeReport = document.getElementById("size-report");



    // function faNumber(number) {
    //   return Intl.NumberFormat('fa').format(number);
    // }
    // var interval = setInterval(function () {
    //   let newScale = modelViewer.scale.split(" ").map((e) => parseFloat(e));
    //   let newDim = [newScale[0] * referenceDim[0], newScale[1] * referenceDim[1], newScale[2] * referenceDim[2]];
    //   sizeReport.textContent = faNumber(newDim[0]) + " × " + faNumber(newDim[2]);
    // }, 1000);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/eruda@3.0.1/eruda.min.js"></script>
  <script>eruda.init();</script>
</body>

</html>